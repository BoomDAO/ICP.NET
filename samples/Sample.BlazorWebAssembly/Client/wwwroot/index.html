<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sample.BlazorWebAssembly</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="Sample.BlazorWebAssembly.Client.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="js/index.bundle.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>

    <script>
        function toHexString(byteArray) {
            return byteArray.reduce((output, elem) =>
                (output + ('0' + elem.toString(16)).slice(-2)),
                '');
        }
        function hexToBytes(hex) {
            for (var bytes = [], c = 0; c < hex.length; c += 2)
                bytes.push(parseInt(hex.substr(c, 2), 16));
            return bytes;
        }
        window.authClientLogin = function (dotNetObject) {
            window.authClient.login({
                onSuccess: () => {
                    dotNetObject.invokeMethodAsync('OnLoginSuccess');
                }
            });
        };
        window.getProposalInfo = async function () {
            const identity = await window.authClient.getIdentity();

            const canisterId = "rrkah-fqaaa-aaaaa-aaaaq-cai";
            console.log(window);
            let agent = new window.HttpAgentType({
                host: "https://ic0.app",
                identity,
                fetch: (url, options) => {
                    console.log(options)
                    console.log(toHexString(new Uint8Array(options.body)));
                }
            });
            let arg = "4449444C000178BFF2000000000000";
            let fields = {
                methodName: "get_proposal_info",
                arg: hexToBytes(arg)
            };
            agent.query(canisterId, fields, identity)
            .then(() => console.log("done"))
        };
        window.authClientLogout = function () {
            window.authClient.logout();
        };
    </script>
</body>

</html>
